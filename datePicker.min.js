(function(e,t,r){function i(e,r){this.scroller=t.querySelector(e),this.childNode=this.scroller.childNodes[0],this.options={step:!0,defaultPlace:0,callback:null},this.startPageY=0,this.startTime=0,this.endTime=0,this.offsetTop=0,this.scrollerHeight=this.scroller.clientHeight,this.childNodeHeight=this.childNode.clientHeight,this.scrollHeight=this.childNodeHeight-this.scrollerHeight;var i=this.childNode.childNodes;this.stepLen=i.length>0?i[0].clientHeight:0;for(var a in r)this.options[a]=r[a];var o=this.options.defaultPlace?this.options.defaultPlace:0;this.scrollTo(0,o),this._start(),this._move(),this._end()}function a(e){this.scrollArray=[],this.textArray=[],this.isScrollTo=!1,this.monthLen=30,this.options={title:"请选择日期",type:"3",maxYear:"",minYear:"",separator:"-",defaultValue:"",callBack:null},e=this.setDefaultOptions(e);for(var t in e)this.options[t]=e[t];if(this.defaultArray=["","","","",""],this.options.defaultValue){var r=this.options.defaultValue+"",i=this.options.separator,a=r.replace(/\:|\s/g,"-").split(i);if(a.length>0)for(var o=0;o<a.length;o+=1)this.defaultArray[o]=a[o]}this.FillData(),this.eventClick()}i.prototype={_start:function(){var e=this;e.scroller.addEventListener("touchstart",function(t){t.stopPropagation(),t.preventDefault(),e.startTime=e.getTime();var r=t.touches?t.touches[0]:t;e.startPageY=r.pageY,e.browserVendor("transition","none")},!1)},_move:function(){var e=this;e.scroller.addEventListener("touchmove",function(t){t.stopPropagation(),t.preventDefault();var i=e.getTime(),a=t.touches?t.touches[0]:t,o=a.pageY-e.startPageY,l=o+e.offsetTop;i-e.endTime>300&&r.abs(o)<10||(l>0?l/=3:r.abs(l)>r.abs(e.scrollHeight)&&(l=r.abs(e.scrollHeight)-r.abs(l),l=l/3-e.scrollHeight),e.browserVendor("transform","translate(0, "+l+"px)"))},!1)},_end:function(){var e=this;e.scroller.addEventListener("touchend",function(t){t.stopPropagation(),t.preventDefault(),e.endTime=e.getTime();var i=e.endTime-e.startTime,a=t.changedTouches?t.changedTouches[0]:t,o=a.pageY-e.startPageY;if(e.offsetTop+=o,e.offsetTop>0||r.abs(e.offsetTop)>r.abs(e.scrollHeight))e.browserVendor("transition","all 500ms");else if(i<300){var l=r.abs(o)/i,s=i*l*20;s=s>2e3?2e3:s,e.offsetTop+=o*l*10,e.browserVendor("transitionProperty","all"),e.browserVendor("transitionDuration",s+"ms"),e.browserVendor("transitionTimingFunction","cubic-bezier(0.1, 0.57, 0.1, 1)")}else e.browserVendor("transition","all 500ms");if(e.offsetTop>0?e.offsetTop=0:r.abs(e.offsetTop)>r.abs(e.scrollHeight)&&(e.offsetTop=-e.scrollHeight),e.options.step&&e.stepLen>0){var n=e.offsetTop,u=r.abs(n%e.stepLen),p=e.stepLen/2,c=u>=p?n-e.stepLen+u:n+u,d=parseInt(r.abs(c)/e.stepLen);e.options.callback({index:d,node:e.childNode.childNodes}),e.offsetTop=c}e.browserVendor("transform","translate(0, "+e.offsetTop+"px)")},!1)},scrollTo:function(e,t,r){var i=this;r&&r>0?(i.browserVendor("transitionProperty","all"),i.browserVendor("transitionDuration",r+"ms"),i.browserVendor("transitionTimingFunction","cubic-bezier(0.1, 0.57, 0.1, 1)")):i.browserVendor("transition","none"),t=-t,i.offsetTop=t,i.browserVendor("transform","translate(0, "+t+"px)")},refresh:function(){this.childNode=this.scroller.childNodes[0],this.startPageY=0,this.startTime=0,this.endTime=0,this.offsetTop=0,this.scrollerHeight=this.scroller.clientHeight,this.childNodeHeight=this.childNode.clientHeight,this.scrollHeight=this.childNodeHeight-this.scrollerHeight;var e=this.childNode.childNodes;this.stepLen=e.length>0?e[0].clientHeight:0,this.scrollTo(0,0,500)},browserVendor:function(e,t){for(var r,i=this,a=["t","WebkitT","MozT","msT","OT"],o=a.length,l=i.childNode.style,s=0;s<o;s+=1)r=a[s]+e.substr(1),r in l&&(l[r]=t)},getTime:function(){return parseInt((new Date).getTime())}},a.prototype={FillData:function(){var e=this;e.enterNodesBlur();var r=t.querySelector(".zx_mask");r&&t.body.removeChild(r);var i=e.options.title?e.options.title:"请选择日期",a=t.createElement("div");a.className="zx_mask";var o='<div class="zx_select showPicker"><header><button class="nav_left picker-cancel">取消</button><h1>'+i+'</h1><button class="nav_right picker-ok">确定</button></header><div class="ub" id="wrapper-parent"><div class="ub-f1 picker-wrapper" id="dp-wrapper0"><ul></ul></div>';e.options.type>0&&(o+='<div class="ub-f1 picker-wrapper" id="dp-wrapper1"><ul></ul></div>'),e.options.type>2&&(o+='<div class="ub-f1 picker-wrapper" id="dp-wrapper2"><ul></ul></div>'),4==e.options.type&&(o+='<div class="ub-f1 picker-wrapper" id="dp-wrapper3"><ul></ul></div><div class="ub-f1 picker-wrapper" id="dp-wrapper4"><ul></ul></div>'),5==e.options.type&&(o+='<div class="ub-f1 picker-wrapper" id="dp-wrapper3"><ul></ul></div>'),o+='<div class="sel_top"></div><div class="sel_bottom"></div>',o+='<div class="sel_middle"></div></div></div>',a.innerHTML=o,t.body.appendChild(a);for(var l=parseFloat(100/e.options.num).toFixed(3)+"%",s=t.querySelectorAll(".picker-wrapper"),n=0;n<s.length;n+=1)s[n].style.fontSize="16px",s[n].style.minWidth=l,s[n].style.maxWidth=l;switch(e.options.type){case 0:t.querySelector("#wrapper-parent").style.padding="0 15%",e.getYearList(0,e.defaultArray[0]);break;case 1:t.querySelector("#wrapper-parent").style.padding="0 15%",e.getYearList(0,e.defaultArray[0]),e.getMonthList(1,e.defaultArray[1]);break;case 2:t.querySelector("#wrapper-parent").style.padding="0 15%",e.getHourList(0,e.defaultArray[0]),e.getMinutesList(1,e.defaultArray[1]);break;case 3:e.getYearList(0,e.defaultArray[0]),e.getMonthList(1,e.defaultArray[1]),e.getDayList(2,e.defaultArray[2]);break;case 4:e.getYearList(0,e.defaultArray[0]),e.getMonthList(1,e.defaultArray[1]),e.getDayList(2,e.defaultArray[2]),e.getHourList(3,e.defaultArray[3]),e.getMinutesList(4,e.defaultArray[4]);break;case 5:e.getYearList(0,e.defaultArray[0]),e.getMonthList(1,e.defaultArray[1]),e.getDayList(2,e.defaultArray[2]),e.getAfternoon(3)}setTimeout(function(){t.querySelector(".zx_select").style.height="245px"},0)},scrollInit:function(e,r){var a=this,o=t.querySelector("#dp-wrapper0").childNodes[0],l=o.childNodes[0].clientHeight,s="#dp-wrapper"+e;a.scrollArray[e]=new i(s,{step:l,defaultPlace:l*r,callback:function(t){var r=t.index+2,i=t.node[r];if(a.SetItemList(e,i),3==a.options.type||4==a.options.type){var o=a.textArray[2].value;if(o>a.monthLen){var s=(a.monthLen-1)*l;a.textArray[2].value=a.monthLen,setTimeout(function(){a.scrollArray[2].scrollTo(0,s,500)},0)}}}}),a.add_EventListen()},SetItemList:function(e,t){var r=this;if(t){var i={};i.value=t.attributes[0].value,i.type=t.innerHTML}else var i="";r.textArray[e]=i,r.getMonthLength()},setDefaultItem:function(e,t){var r=this,i={};i.value=t,r.textArray[e]=i},getYearList:function(e,r){var i=this,a="<li></li><li></li>",o="",l=i.options.maxYear,s=i.options.minYear;if(r){for(var n=0,u=!1,p=l;p>s;p-=1)r==p&&(u=!0,o=n,i.setDefaultItem(e,p)),a+='<li data-value="'+p+'">'+p+"年</li>",n+=1;u||i.setDefaultItem(e,l)}else{for(var p=l;p>s;p-=1)a+='<li data-value="'+p+'">'+p+"年</li>";i.setDefaultItem(e,l)}a+="<li></li><li></li>",t.querySelector("#dp-wrapper"+e).childNodes[0].innerHTML=a,setTimeout(function(){i.scrollInit(e,o)},0)},getMonthList:function(e,r){var i=this,a="<li></li><li></li>",o="",l="月",s="0";if(r){for(var n=0,u=!1,p=1;p<=12;p+=1){var c=p<10?s+p:p;r==p&&(u=!0,o=n,i.setDefaultItem(e,c)),a+='<li data-value="'+c+'">'+c+l+"</li>",n+=1}u||i.setDefaultItem(e,"01")}else{for(var p=1;p<=12;p+=1){var c=p<10?s+p:p;a+='<li data-value="'+c+'">'+c+l+"</li>"}i.setDefaultItem(e,s+1)}a+="<li></li><li></li>",t.querySelector("#dp-wrapper"+e).childNodes[0].innerHTML=a,setTimeout(function(){i.scrollInit(e,o)},0)},getDayList:function(e,r){var i=this,a="<li></li><li></li>",o="",l="日",s="0";if(r){for(var n=0,u=!1,p=1;p<=31;p+=1){var c=p<10?s+p:p;r==c&&(u=!0,o=n,i.setDefaultItem(e,c)),a+='<li data-value="'+c+'">'+c+l+"</li>",n+=1}u||i.setDefaultItem(e,"01")}else{for(var p=1;p<=31;p+=1){var c=p<10?s+p:p;a+='<li data-value="'+c+'">'+c+l+"</li>"}i.setDefaultItem(e,s+1)}a+="<li></li><li></li>",t.querySelector("#dp-wrapper"+e).childNodes[0].innerHTML=a,setTimeout(function(){i.scrollInit(e,o)},0)},getHourList:function(e,r){var i=this,a="<li></li><li></li>",o="",l="时",s="0";if(r){for(var n=0,u=!1,p=0;p<=23;p+=1){var c=p<10?s+p:p;r==c&&(u=!0,o=n,i.setDefaultItem(e,c)),a+='<li data-value="'+c+'">'+c+l+"</li>",n+=1}u||i.setDefaultItem(e,"01")}else{for(var p=0;p<=23;p+=1){var c=p<10?s+p:p;a+='<li data-value="'+c+'">'+c+l+"</li>"}i.setDefaultItem(e,s+1)}a+="<li></li><li></li>",t.querySelector("#dp-wrapper"+e).childNodes[0].innerHTML=a,setTimeout(function(){i.scrollInit(e,o)},0)},getMinutesList:function(e,r){var i=this,a="<li></li><li></li>",o="",l="分",s="0";if(r){for(var n=0,u=!1,p=0;p<=59;p+=1){var c=p<10?s+p:p;r==c&&(u=!0,o=n,i.setDefaultItem(e,c)),a+='<li data-value="'+c+'">'+c+l+"</li>",n+=1}u||i.setDefaultItem(e,"01")}else{for(var p=0;p<=59;p+=1){var c=p<10?s+p:p;a+='<li data-value="'+c+'">'+c+l+"</li>"}i.setDefaultItem(e,s+1)}a+="<li></li><li></li>",t.querySelector("#dp-wrapper"+e).childNodes[0].innerHTML=a,setTimeout(function(){i.scrollInit(e,o)},0)},getAfternoon:function(e){var r=this,i="<li></li><li></li>",a="";i+='<li data-value="上午">上午</li><li data-value="下午">下午</li>',r.setDefaultItem(e,"上午"),i+="<li></li><li></li>",t.querySelector("#dp-wrapper"+e).childNodes[0].innerHTML=i,setTimeout(function(){r.scrollInit(e,a)},0)},HidePicker:function(){var e=this;t.querySelector(".zx_select").style.height="0",e.remove_EventListen(),setTimeout(function(){var r=t.querySelector(".zx_mask");t.body.removeChild(r),e.destroy()},200)},eventClick:function(){var e=this;t.querySelector(".picker-cancel").addEventListener("touchstart",function(t){t.stopPropagation(),t.preventDefault(),e.HidePicker()}),t.querySelector(".picker-ok").addEventListener("touchstart",function(t){t.stopPropagation(),t.preventDefault();for(var r="",i=0;i<e.textArray.length;i+=1)r+=0==i?e.textArray[i].value:2==e.options.type?":"+e.textArray[i].value:4==e.options.type?3==i?" "+e.textArray[i].value:4==i?":"+e.textArray[i].value:e.options.separator+e.textArray[i].value:5==e.options.type&&3==i?" "+e.textArray[i].value:e.options.separator+e.textArray[i].value;e.options.callBack&&e.options.callBack(r),e.HidePicker()})},setDefaultOptions:function(e){var t=new Date,r=t.getFullYear(),i=t.getMonth()+1,a=t.getDate(),o=t.getHours(),l=t.getMinutes(),s=parseInt(e.type);return s&&(s<0||s>5)?e.type=3:0==s?e.type=0:e.type=s?s:3,e.separator=e.separator?e.separator:"-",i=i<10?"0"+i:i,a=a<10?"0"+a:a,o=o<10?"0"+o:o,l=l<10?"0"+l:l,e.defaultValue&&""!=e.defaultValue||(0==e.type?e.defaultValue=r:1==e.type?e.defaultValue=r+e.separator+i:2==e.type?e.defaultValue=o+":"+l:3==e.type||5==e.type?e.defaultValue=r+e.separator+i+e.separator+a:4==e.type&&(e.defaultValue=r+e.separator+i+e.separator+a+" "+o+":"+l)),e.maxYear=e.maxYear?e.maxYear:r+100,e.minYear=e.minYear?e.minYear:r-100,e},getMonthLength:function(){var e=this;if(3==e.options.type||4==e.options.type){var t=e.textArray[0].value,r=e.textArray[1].value,i=e.isLeap(t);"02"==r?e.monthLen=28+i:"01"==r||"03"==r||"05"==r||"07"==r||"08"==r||"10"==r||"12"==r?e.monthLen=31:e.monthLen=30}},isLeap:function(e){return e%4==0&&e%100!=0||e%400==0?1:0},enterNodesBlur:function(){for(var e=t.querySelectorAll("input"),r=0;r<e.length;r+=1)e[r].blur();for(var i=t.querySelectorAll("textarea"),a=0;a<i.length;a+=1)i[a].blur()},touchDefault:function(e){e.preventDefault()},touchStop:function(e){e.stopPropagation(),e.preventDefault()},add_EventListen:function(){var e=this;t.addEventListener("touchmove",e.touchDefault,!1)},remove_EventListen:function(){var e=this;t.removeEventListener("touchmove",e.touchDefault,!1)},destroy:function(){var e=this;e.options=null,e.scrollArray=[],e.textArray=[],e.isScrollTo=!1,e.monthLen=30}},"undefined"!=typeof module&&module.exports?module.exports=a:e.DatePicker=a})(window,document,Math);